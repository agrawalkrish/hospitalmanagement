<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patients</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="card">
        <h2>Manage Patients</h2>
        
        <!-- Add Patient Form -->
        <form id="addPatientForm" onsubmit="addPatient(event)">
            <label for="first_name">First Name:</label>
            <input type="text" id="first_name" name="first_name" required>
            
            <label for="last_name">Last Name:</label>
            <input type="text" id="last_name" name="last_name" required>
            
            <label for="date_of_birth">Date of Birth:</label>
            
            <input type="date" id="date_of_birth" name="date_of_birth">
            
            <label for="gender">Gender:</label>
            <input type="text" id="gender" name="gender">
            
            <label for="address">Address:</label>
            <input type="text" id="address" name="address">
            
            <label for="contact_number">Contact Number:</label>
            <input type="text" id="contact_number" name="contact_number">
            
            <label for="insurance_information">Insurance Information:</label>
            <input type="text" id="insurance_information" name="insurance_information">
            
            <button type="submit">Add Patient</button>
        </form>
    
        <!-- Display Patient List -->
        <h3>Patient List</h3>
        <table id="patientTable">
            <tr>
                <th>Patient ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>DOB</th>
                <th>Gender</th>
                <th>Address</th>
                <th>Contact</th>
                <th>Insurance Info</th>
            </tr>
            <!-- Rows for patient data will be dynamically inserted here -->
        </table>
    </div>
    <script>
        // Fetch and display all patients when loading the page
        document.addEventListener("DOMContentLoaded", () => {
            fetch("http://localhost:3000/patients")
                .then(response => response.json())
                .then(data => {
                    const table = document.getElementById("patientTable");
                    data.forEach(patient => {
                        const newRow = table.insertRow();
                        newRow.innerHTML = `
                            <td>${patient.patient_id}</td>
                            <td>${patient.first_name}</td>
                            <td>${patient.last_name}</td>
                            <td>${patient.date_of_birth}</td>
                            <td>${patient.gender}</td>
                            <td>${patient.address}</td>
                            <td>${patient.contact_number}</td>
                            <td>${patient.insurance_information}</td>
                            <td><button onclick="deletePatient(${patient.patient_id})">Delete</button></td>
                        `;
                    });
                })
                .catch(error => console.error("Error fetching patients:", error));
        });
    
    // Function to handle form submission and add patient to the database
    function addPatient(event) {
        event.preventDefault();
    
        const Patient = {
            first_name: document.getElementById("first_name").value,
            last_name: document.getElementById("last_name").value,
            date_of_birth: document.getElementById("date_of_birth").value,
            gender: document.getElementById("gender").value,
            address: document.getElementById("address").value,
            contact_number: document.getElementById("contact_number").value,
            insurance_information: document.getElementById("insurance_information").value,
        };
    
        fetch("http://localhost:3000/patients", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(Patient)
        })
        .then(response => response.json())
        .then(data => {
            console.log(data.message);
    
            // Append the new patient to the table
            const table = document.getElementById("patient");
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td>${data.patientId}</td>
                <td>${Patient.first_name}</td>
                <td>${Patient.last_name}</td>
                <td>${Patient.date_of_birth}</td>
                <td>${Patient.gender}</td>
                <td>${Patient.address}</td>
                <td>${Patient.contact_number}</td>
                <td>${Patient.insurance_information}</td>
            `;
    
            // Clear the form
            document.getElementById("addPatientForm").reset();
        })
        .catch(error => console.error("Error adding patient:", error));
    }
    
    // Function to delete a patient
    function deletePatient(patientId) {
            if (confirm("Are you sure you want to delete this patient?")) {
                fetch(`http://localhost:3000/patients/${patientId}`, {
                    method: "DELETE"
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to delete patient");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data.message);
    
                    // Find and remove the deleted patient's row in the table
                    const table = document.getElementById("patientTable");
                    for (let i = 1; i < table.rows.length; i++) {
                        if (table.rows[i].cells[0].innerText == patientId) {
                            table.deleteRow(i);
                            break;
                        }
                    }
                })
                .catch(error => console.error("Error deleting patient:", error));
            }
        }
    
    
    </script>
    
</body>
</html>